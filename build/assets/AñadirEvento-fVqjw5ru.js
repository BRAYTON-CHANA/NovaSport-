import{u as P,t as T,v as O,r as p,j as e}from"./index-g1PumTm4.js";import{D as U,r as z}from"./index.es-CE8XIQIh.js";import{E as G,e as K}from"./EditListModal-DJyDcutu.js";import{S as _,H as J}from"./Header-HN8A8OWr.js";import{G as B}from"./GestionInstalacionesModal-D1O17sLp.js";import"./floating-ui.react-dom-CY_ef83B.js";import"./index-Ei0h8sv0.js";z("es",K);const I=({selected:t,onChange:o,hasError:c})=>{const v=Array.from({length:12},(a,m)=>m+1),k=Array.from({length:60},(a,m)=>m.toString().padStart(2,"0")),h=t?t.getHours():0,n=t?t.getMinutes():0,r=h%12===0?12:h%12,l=h>=12?"PM":"AM",N=(a,m)=>{const b=t?new Date(t):new Date;let f=b.getHours();if(a==="hour"){const x=parseInt(m,10),s=f>=12;s&&x!==12?b.setHours(x+12):!s&&x===12?b.setHours(0):b.setHours(x)}else if(a==="minute")b.setMinutes(parseInt(m,10));else if(a==="ampm"){const x=m==="PM";x&&f<12?b.setHours(f+12):!x&&f>=12&&b.setHours(f-12)}o(b)},j=c?"border-rose-500":"dark:border-gray-600";return e.jsxs("div",{className:`flex gap-2 rounded-md border ${j} p-1.5`,children:[e.jsx("select",{value:r,onChange:a=>N("hour",a.target.value),className:"form-select dark:bg-gray-800 border-none w-full",children:v.map(a=>e.jsx("option",{value:a,children:a},a))}),e.jsx("select",{value:n.toString().padStart(2,"0"),onChange:a=>N("minute",a.target.value),className:"form-select dark:bg-gray-800 border-none w-full",children:k.map(a=>e.jsx("option",{value:a,children:a},a))}),e.jsxs("select",{value:l,onChange:a=>N("ampm",a.target.value),className:"form-select dark:bg-gray-800 border-none w-full",children:[e.jsx("option",{children:"AM"}),e.jsx("option",{children:"PM"})]})]})},Q=({formData:t,handleInputChange:o,database:c,settings:v,handleOpenModal:k,handleOpenInstalacionesModal:h,errors:n})=>e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"p-5 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 dark:text-gray-100 mb-4",children:"Datos del Evento"}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1 dark:text-gray-300",htmlFor:"nombreEvento",children:["Nombre Evento ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsx("input",{id:"nombreEvento",type:"text",name:"nombreEvento",onChange:o,value:t.nombreEvento,className:`form-input w-full dark:bg-gray-700 ${n.nombreEvento?"border-rose-500":""}`,required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1 dark:text-gray-300",htmlFor:"instalacion",children:["Instalación ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("select",{id:"instalacion",name:"instalacion",onChange:o,value:t.instalacion,className:`form-select w-full dark:bg-gray-700 ${n.instalacion?"border-rose-500":""}`,required:!0,children:(c.Instalaciones||[]).map(r=>e.jsx("option",{value:r.nombre,children:r.nombre},r.id))}),e.jsx("button",{type:"button",onClick:h,className:"btn bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200",children:"Gestionar"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1 dark:text-gray-300",htmlFor:"tipoEvento",children:["Tipo Evento ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("select",{id:"tipoEvento",name:"tipoEvento",onChange:o,value:t.tipoEvento,className:`form-select w-full dark:bg-gray-700 ${n.tipoEvento?"border-rose-500":""}`,required:!0,children:(v.comboValues.tiposEvento||[]).map(r=>e.jsx("option",{children:r},r))}),e.jsx("button",{type:"button",onClick:()=>k("tiposEvento"),className:"btn bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200",children:"..."})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1 dark:text-gray-300",htmlFor:"motivo",children:["Motivo ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("select",{id:"motivo",name:"motivo",onChange:o,value:t.motivo,className:`form-select w-full dark:bg-gray-700 ${n.motivo?"border-rose-500":""}`,required:!0,children:(v.comboValues.motivos||[]).map(r=>e.jsx("option",{children:r},r))}),e.jsx("button",{type:"button",onClick:()=>k("motivos"),className:"btn bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200",children:"..."})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium mb-1 dark:text-gray-300",htmlFor:"descripcion",children:"Descripción"}),e.jsx("textarea",{id:"descripcion",name:"descripcion",onChange:o,value:t.descripcion,className:"form-textarea w-full md:col-span-2 dark:bg-gray-700"})]})]})]}),e.jsxs("div",{className:"p-5 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 dark:text-gray-100 mb-4",children:"Datos del Remitente"}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1 dark:text-gray-300",htmlFor:"nombreRemitente",children:["Nombre Remitente ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsx("input",{id:"nombreRemitente",type:"text",name:"nombreRemitente",onChange:o,value:t.nombreRemitente,className:`form-input w-full dark:bg-gray-700 ${n.nombreRemitente?"border-rose-500":""}`,required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1 dark:text-gray-300",htmlFor:"cargo",children:["Cargo ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsx("input",{id:"cargo",type:"text",name:"cargo",onChange:o,value:t.cargo,className:`form-input w-full dark:bg-gray-700 ${n.cargo?"border-rose-500":""}`,required:!0})]})]})]}),e.jsxs("div",{className:"p-5",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 dark:text-gray-100 mb-4",children:"Datos del Solicitante"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{id:"representaInstitucion",type:"checkbox",name:"representaInstitucion",onChange:o,checked:t.representaInstitucion,className:"form-checkbox"}),e.jsx("label",{className:"ml-2 text-sm text-gray-600 dark:text-gray-300",htmlFor:"representaInstitucion",children:"¿Representa a una institución o entidad?"})]}),t.representaInstitucion&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 dark:text-gray-300",htmlFor:"cualInstitucion",children:"¿Cuál?"}),e.jsx("input",{id:"cualInstitucion",type:"text",name:"cualInstitucion",onChange:o,value:t.cualInstitucion,className:`form-input w-full dark:bg-gray-700 ${n.cualInstitucion?"border-rose-500":""}`})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1 dark:text-gray-300",htmlFor:"nombreSolicitante",children:["Nombre Solicitante ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsx("input",{id:"nombreSolicitante",type:"text",name:"nombreSolicitante",onChange:o,value:t.nombreSolicitante,className:`form-input w-full dark:bg-gray-700 ${n.nombreSolicitante?"border-rose-500":""}`,required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1 dark:text-gray-300",htmlFor:"dniRuc",children:["DNI/RUC ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsx("input",{id:"dniRuc",type:"text",name:"dniRuc",onChange:o,value:t.dniRuc,className:`form-input w-full dark:bg-gray-700 ${n.dniRuc?"border-rose-500":""}`,required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1 dark:text-gray-300",htmlFor:"correo",children:["Correo ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsx("input",{id:"correo",type:"email",name:"correo",onChange:o,value:t.correo,className:`form-input w-full dark:bg-gray-700 ${n.correo?"border-rose-500":""}`,required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1 dark:text-gray-300",htmlFor:"telefono",children:["Teléfono ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsx("input",{id:"telefono",type:"tel",name:"telefono",onChange:o,value:t.telefono,className:`form-input w-full dark:bg-gray-700 ${n.telefono?"border-rose-500":""}`,required:!0})]})]})]})]})]}),W=({formData:t,horarios:o,setHorarios:c,settings:v,handleOpenModal:k,errors:h,setErrors:n})=>{const r=()=>{const s=new Date;s.setHours(8,0,0,0);const g=new Date;return g.setHours(9,0,0,0),{espacioDeportivo:v.comboValues.espaciosDeportivos&&v.comboValues.espaciosDeportivos[0]||"",fecha:null,horaInicio:s,horaFin:g}},[l,N]=p.useState(r()),[j,a]=p.useState({});p.useEffect(()=>{N(r())},[v]);const m=(s,g)=>{N(u=>({...u,[s]:g})),j[s]&&a(u=>({...u,[s]:!1}))},b=()=>{const s={};return l.fecha||(s.fecha=!0),l.horaFin<=l.horaInicio&&(s.horaFin=!0),s},f=()=>{const s=b();if(Object.keys(s).length>0){a(s);return}const g={id:crypto.randomUUID(),espacioDeportivo:l.espacioDeportivo,fecha:l.fecha.toLocaleDateString("es-ES"),horaInicio:l.horaInicio.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0}),horaFin:l.horaFin.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})};c(u=>[...u,g]),N(r()),a({}),h.global&&n(u=>({...u,global:null}))},x=s=>{c(g=>g.filter(u=>u.id!==s))};return e.jsxs("div",{className:"p-5",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 dark:text-gray-100 mb-4",children:['Configuración de Horario para "',t.nombreEvento,'"']}),h.global&&e.jsx("div",{className:"mb-4 text-center text-sm text-rose-500",children:h.global}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4 items-start border p-4 rounded-md dark:border-gray-700",children:[e.jsxs("div",{className:"md:col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium mb-1 dark:text-gray-300",children:"Espacio Deportivo"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("select",{name:"espacioDeportivo",value:l.espacioDeportivo,onChange:s=>m("espacioDeportivo",s.target.value),className:"form-select w-full dark:bg-gray-700",children:(v.comboValues.espaciosDeportivos||[]).map(s=>e.jsx("option",{children:s},s))}),e.jsx("button",{type:"button",onClick:()=>k("espaciosDeportivos"),className:"btn bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200",children:"..."})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 dark:text-gray-300",children:"Fecha"}),e.jsx(U,{selected:l.fecha,onChange:s=>m("fecha",s),dateFormat:"dd/MM/yyyy",locale:"es",className:`form-input w-full dark:bg-gray-700 ${j.fecha?"border-rose-500":""}`,placeholderText:"Seleccionar fecha"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 dark:text-gray-300",children:"Hora Inicio"}),e.jsx(I,{selected:l.horaInicio,onChange:s=>m("horaInicio",s),hasError:j.horaInicio})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 dark:text-gray-300",children:"Hora Fin"}),e.jsx(I,{selected:l.horaFin,onChange:s=>m("horaFin",s),hasError:j.horaFin}),j.horaFin&&e.jsx("div",{className:"text-xs mt-1 text-rose-500",children:"La hora de fin debe ser posterior a la de inicio."})]}),e.jsx("div",{className:"md:col-span-4 flex justify-end mt-2",children:e.jsx("button",{type:"button",onClick:f,className:"btn bg-indigo-500 hover:bg-indigo-600 text-white",children:"Añadir Horario"})})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h3",{className:"text-md font-semibold text-gray-800 dark:text-gray-100 mb-2",children:"Horarios Agregados"}),o.length===0?e.jsx("div",{className:"text-center py-8 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Aún no se han agregado horarios para este evento."})}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table-auto w-full dark:text-gray-300",children:[e.jsx("thead",{className:"text-xs font-semibold uppercase text-gray-500 bg-gray-50 dark:bg-gray-700 dark:bg-opacity-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 whitespace-nowrap",children:e.jsx("div",{className:"font-semibold text-left",children:"Espacio Deportivo"})}),e.jsx("th",{className:"p-2 whitespace-nowrap",children:e.jsx("div",{className:"font-semibold text-left",children:"Fecha"})}),e.jsx("th",{className:"p-2 whitespace-nowrap",children:e.jsx("div",{className:"font-semibold text-left",children:"Hora Inicio"})}),e.jsx("th",{className:"p-2 whitespace-nowrap",children:e.jsx("div",{className:"font-semibold text-left",children:"Hora Fin"})}),e.jsx("th",{className:"p-2 whitespace-nowrap",children:e.jsx("div",{className:"font-semibold text-center",children:"Acciones"})})]})}),e.jsx("tbody",{className:"text-sm divide-y divide-gray-100 dark:divide-gray-700",children:o.map(s=>e.jsxs("tr",{children:[e.jsx("td",{className:"p-2 whitespace-nowrap",children:s.espacioDeportivo}),e.jsx("td",{className:"p-2 whitespace-nowrap",children:s.fecha}),e.jsx("td",{className:"p-2 whitespace-nowrap",children:s.horaInicio}),e.jsx("td",{className:"p-2 whitespace-nowrap",children:s.horaFin}),e.jsx("td",{className:"p-2 whitespace-nowrap text-center",children:e.jsx("button",{onClick:()=>x(s.id),className:"text-rose-500 hover:text-rose-600",children:"Eliminar"})})]},s.id))})]})})]})]})};function re(){const{database:t,agregarEventoCompleto:o}=P(),{settings:c,updateSettings:v}=T(),k=O(),[h,n]=p.useState(!1),[r,l]=p.useState(1),[N,j]=p.useState(!1),[a,m]=p.useState(null),[b,f]=p.useState(!1),x=(i,d)=>{var y;return{nombreEvento:"Evento de Prueba",instalacion:i.Instalaciones&&((y=i.Instalaciones[0])==null?void 0:y.nombre)||"",tipoEvento:d.comboValues.tiposEvento&&d.comboValues.tiposEvento[0]||"",motivo:d.comboValues.motivos&&d.comboValues.motivos[0]||"",descripcion:"",nombreRemitente:"Juan Pérez",cargo:"Organizador",representaInstitucion:!1,cualInstitucion:"",nombreSolicitante:"Maria Lopez",dniRuc:"12345678",correo:"maria.lopez@email.com",telefono:"987654321"}},[s,g]=p.useState(t?x(t,c):{}),[u,H]=p.useState([]),[E,w]=p.useState({});p.useEffect(()=>{t&&g(x(t,c))},[t,c]);const D=i=>{const{name:d,value:y,type:S,checked:L}=i.target;g(F=>({...F,[d]:S==="checkbox"?L:y})),E[d]&&w(F=>({...F,[d]:!1}))},M=()=>{const i={};return["nombreEvento","instalacion","tipoEvento","motivo","nombreRemitente","cargo","nombreSolicitante","dniRuc","correo","telefono"].forEach(y=>{s[y]||(i[y]=!0)}),s.representaInstitucion&&!s.cualInstitucion&&(i.cualInstitucion=!0),i},R=i=>{i.preventDefault();const d=M();w(d),Object.keys(d).length===0&&l(2)},V=()=>{w({}),l(1)},$=async()=>{if(u.length===0){w(y=>({...y,global:"Debe agregar al menos un horario para guardar el evento."}));return}const i={...s},d=u.map(({id:y,...S})=>S);await o({eventoData:i,horariosData:d}),g(x(t,c)),H([]),l(1),w({}),k("/gestion-eventos")},C=i=>{m(i),j(!0)},A=(i,d)=>{v({comboValues:{...c.comboValues,[i]:d}}),j(!1)},q=()=>`Editar ${{tiposEvento:"Tipos de Evento",motivos:"Motivos",espaciosDeportivos:"Espacios Deportivos"}[a]||"Lista"}`;return t?e.jsxs("div",{className:"flex h-screen overflow-hidden",children:[e.jsx(_,{sidebarOpen:h,setSidebarOpen:n}),e.jsxs("div",{className:"relative flex flex-col flex-1 overflow-y-auto overflow-x-hidden",children:[e.jsx(J,{sidebarOpen:h,setSidebarOpen:n}),e.jsx("main",{className:"grow",children:e.jsxs("div",{className:"px-4 sm:px-6 lg:px-8 py-8 w-full max-w-9xl mx-auto",children:[e.jsx("h1",{className:"text-2xl md:text-3xl text-gray-800 dark:text-gray-100 font-bold mb-8",children:"Añadir Nuevo Evento"}),e.jsx("div",{className:"bg-white dark:bg-gray-800 shadow-lg rounded-sm border border-gray-200 dark:border-gray-700 p-6",children:e.jsxs("form",{onSubmit:i=>i.preventDefault(),children:[r===1&&e.jsx(Q,{formData:s,handleInputChange:D,database:t,settings:c,handleOpenModal:C,handleOpenInstalacionesModal:()=>f(!0),errors:E}),r===2&&e.jsx(W,{formData:s,horarios:u,setHorarios:H,settings:c,handleOpenModal:C,errors:E,setErrors:w}),e.jsxs("div",{className:"flex justify-between items-center mt-8",children:[e.jsx("div",{children:r===2&&e.jsx("button",{onClick:V,className:"btn bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-100 hover:bg-gray-300 dark:hover:bg-gray-600",children:"Atrás"})}),e.jsxs("div",{className:"flex gap-4",children:[r===1&&e.jsx("button",{onClick:R,className:"btn bg-indigo-500 hover:bg-indigo-600 text-white",children:"Siguiente"}),r===2&&e.jsx("button",{onClick:$,className:"btn bg-emerald-500 hover:bg-emerald-600 text-white",children:"Guardar Evento"})]})]})]})})]})}),e.jsx(G,{modalOpen:N,setModalOpen:j,title:q(),items:a&&c.comboValues[a]?c.comboValues[a]:[],onSave:i=>A(a,i)}),e.jsx(B,{isVisible:b,onClose:()=>f(!1),instalaciones:t.Instalaciones||[]})]})]}):e.jsx("div",{children:"Cargando..."})}export{re as default};
