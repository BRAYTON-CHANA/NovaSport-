import{w as V,u as _,t as G,v as U,r as b,l as B,m as K,j as e}from"./index-g1PumTm4.js";import{D as z,r as J}from"./index.es-CE8XIQIh.js";import{E as Q,e as W}from"./EditListModal-DJyDcutu.js";import{S as X,H as Y}from"./Header-HN8A8OWr.js";import{G as Z}from"./GestionInstalacionesModal-D1O17sLp.js";import"./floating-ui.react-dom-CY_ef83B.js";import"./index-Ei0h8sv0.js";J("es",W);const R=({selected:t,onChange:r,hasError:f})=>{const p=Array.from({length:12},(a,m)=>m+1),N=Array.from({length:60},(a,m)=>m.toString().padStart(2,"0")),d=t?t.getHours():0,n=t?t.getMinutes():0,i=d%12===0?12:d%12,c=d>=12?"PM":"AM",y=(a,m)=>{const x=t?new Date(t):new Date;let g=x.getHours();if(a==="hour"){const v=parseInt(m,10),s=g>=12;s&&v!==12?x.setHours(v+12):!s&&v===12?x.setHours(0):x.setHours(v)}else if(a==="minute")x.setMinutes(parseInt(m,10));else if(a==="ampm"){const v=m==="PM";v&&g<12?x.setHours(g+12):!v&&g>=12&&x.setHours(g-12)}r(x)},u=f?"border-rose-500":"dark:border-gray-600";return e.jsxs("div",{className:`flex gap-2 rounded-md border ${u} p-1.5`,children:[e.jsx("select",{value:i,onChange:a=>y("hour",a.target.value),className:"form-select dark:bg-gray-800 border-none w-full",children:p.map(a=>e.jsx("option",{value:a,children:a},a))}),e.jsx("select",{value:n.toString().padStart(2,"0"),onChange:a=>y("minute",a.target.value),className:"form-select dark:bg-gray-800 border-none w-full",children:N.map(a=>e.jsx("option",{value:a,children:a},a))}),e.jsxs("select",{value:c,onChange:a=>y("ampm",a.target.value),className:"form-select dark:bg-gray-800 border-none w-full",children:[e.jsx("option",{children:"AM"}),e.jsx("option",{children:"PM"})]})]})},ee=({formData:t,handleInputChange:r,database:f,settings:p,handleOpenModal:N,handleOpenInstalacionesModal:d,errors:n})=>e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"p-5 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 dark:text-gray-100 mb-4",children:"Datos del Evento"}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1 dark:text-gray-300",htmlFor:"nombreEvento",children:["Nombre Evento ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsx("input",{id:"nombreEvento",type:"text",name:"nombreEvento",onChange:r,value:t.nombreEvento,className:`form-input w-full dark:bg-gray-700 ${n.nombreEvento?"border-rose-500":""}`,required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1 dark:text-gray-300",htmlFor:"instalacion",children:["Instalación ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("select",{id:"instalacion",name:"instalacion",onChange:r,value:t.instalacion,className:`form-select w-full dark:bg-gray-700 ${n.instalacion?"border-rose-500":""}`,required:!0,children:(f.Instalaciones||[]).map(i=>e.jsx("option",{value:i.nombre,children:i.nombre},i.id))}),e.jsx("button",{type:"button",onClick:d,className:"btn bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200",children:"Gestionar"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1 dark:text-gray-300",htmlFor:"tipoEvento",children:["Tipo Evento ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("select",{id:"tipoEvento",name:"tipoEvento",onChange:r,value:t.tipoEvento,className:`form-select w-full dark:bg-gray-700 ${n.tipoEvento?"border-rose-500":""}`,required:!0,children:(p.comboValues.tiposEvento||[]).map(i=>e.jsx("option",{children:i},i))}),e.jsx("button",{type:"button",onClick:()=>N("tiposEvento"),className:"btn bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200",children:"..."})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1 dark:text-gray-300",htmlFor:"motivo",children:["Motivo ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("select",{id:"motivo",name:"motivo",onChange:r,value:t.motivo,className:`form-select w-full dark:bg-gray-700 ${n.motivo?"border-rose-500":""}`,required:!0,children:(p.comboValues.motivos||[]).map(i=>e.jsx("option",{children:i},i))}),e.jsx("button",{type:"button",onClick:()=>N("motivos"),className:"btn bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200",children:"..."})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium mb-1 dark:text-gray-300",htmlFor:"descripcion",children:"Descripción"}),e.jsx("textarea",{id:"descripcion",name:"descripcion",onChange:r,value:t.descripcion,className:"form-textarea w-full md:col-span-2 dark:bg-gray-700"})]})]})]}),e.jsxs("div",{className:"p-5 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 dark:text-gray-100 mb-4",children:"Datos del Remitente"}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1 dark:text-gray-300",htmlFor:"nombreRemitente",children:["Nombre Remitente ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsx("input",{id:"nombreRemitente",type:"text",name:"nombreRemitente",onChange:r,value:t.nombreRemitente,className:`form-input w-full dark:bg-gray-700 ${n.nombreRemitente?"border-rose-500":""}`,required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1 dark:text-gray-300",htmlFor:"cargo",children:["Cargo ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsx("input",{id:"cargo",type:"text",name:"cargo",onChange:r,value:t.cargo,className:`form-input w-full dark:bg-gray-700 ${n.cargo?"border-rose-500":""}`,required:!0})]})]})]}),e.jsxs("div",{className:"p-5",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 dark:text-gray-100 mb-4",children:"Datos del Solicitante"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{id:"representaInstitucion",type:"checkbox",name:"representaInstitucion",onChange:r,checked:t.representaInstitucion,className:"form-checkbox"}),e.jsx("label",{className:"ml-2 text-sm text-gray-600 dark:text-gray-300",htmlFor:"representaInstitucion",children:"¿Representa a una institución o entidad?"})]}),t.representaInstitucion&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 dark:text-gray-300",htmlFor:"cualInstitucion",children:"¿Cuál?"}),e.jsx("input",{id:"cualInstitucion",type:"text",name:"cualInstitucion",onChange:r,value:t.cualInstitucion,className:`form-input w-full dark:bg-gray-700 ${n.cualInstitucion?"border-rose-500":""}`})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1 dark:text-gray-300",htmlFor:"nombreSolicitante",children:["Nombre Solicitante ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsx("input",{id:"nombreSolicitante",type:"text",name:"nombreSolicitante",onChange:r,value:t.nombreSolicitante,className:`form-input w-full dark:bg-gray-700 ${n.nombreSolicitante?"border-rose-500":""}`,required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1 dark:text-gray-300",htmlFor:"dniRuc",children:["DNI/RUC ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsx("input",{id:"dniRuc",type:"text",name:"dniRuc",onChange:r,value:t.dniRuc,className:`form-input w-full dark:bg-gray-700 ${n.dniRuc?"border-rose-500":""}`,required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1 dark:text-gray-300",htmlFor:"correo",children:["Correo ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsx("input",{id:"correo",type:"email",name:"correo",onChange:r,value:t.correo,className:`form-input w-full dark:bg-gray-700 ${n.correo?"border-rose-500":""}`,required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1 dark:text-gray-300",htmlFor:"telefono",children:["Teléfono ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsx("input",{id:"telefono",type:"tel",name:"telefono",onChange:r,value:t.telefono,className:`form-input w-full dark:bg-gray-700 ${n.telefono?"border-rose-500":""}`,required:!0})]})]})]})]})]}),se=({formData:t,horarios:r,setHorarios:f,settings:p,handleOpenModal:N,errors:d,setErrors:n})=>{const i=()=>{const s=new Date;s.setHours(8,0,0,0);const j=new Date;return j.setHours(9,0,0,0),{espacioDeportivo:p.comboValues.espaciosDeportivos&&p.comboValues.espaciosDeportivos[0]||"",fecha:null,horaInicio:s,horaFin:j}},[c,y]=b.useState(i()),[u,a]=b.useState({});b.useEffect(()=>{y(i())},[p]);const m=(s,j)=>{y(l=>({...l,[s]:j})),u[s]&&a(l=>({...l,[s]:!1}))},x=()=>{const s={};return c.fecha||(s.fecha=!0),c.horaFin<=c.horaInicio&&(s.horaFin=!0),s},g=()=>{const s=x();if(Object.keys(s).length>0){a(s);return}const j={id:crypto.randomUUID(),espacioDeportivo:c.espacioDeportivo,fecha:c.fecha.toLocaleDateString("es-ES"),horaInicio:c.horaInicio.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0}),horaFin:c.horaFin.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})};f(l=>[...l,j]),y(i()),a({}),d.global&&n(l=>({...l,global:null}))},v=s=>{f(j=>j.filter(l=>l.id!==s))};return e.jsxs("div",{className:"p-5",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 dark:text-gray-100 mb-4",children:['Configuración de Horario para "',t.nombreEvento||"",'"']}),d.global&&e.jsx("div",{className:"mb-4 text-center text-sm text-rose-500",children:d.global}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4 items-start border p-4 rounded-md dark:border-gray-700",children:[e.jsxs("div",{className:"md:col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium mb-1 dark:text-gray-300",children:"Espacio Deportivo"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("select",{name:"espacioDeportivo",value:c.espacioDeportivo,onChange:s=>m("espacioDeportivo",s.target.value),className:"form-select w-full dark:bg-gray-700",children:(p.comboValues.espaciosDeportivos||[]).map(s=>e.jsx("option",{children:s},s))}),e.jsx("button",{type:"button",onClick:()=>N("espaciosDeportivos"),className:"btn bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200",children:"..."})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 dark:text-gray-300",children:"Fecha"}),e.jsx(z,{selected:c.fecha,onChange:s=>m("fecha",s),dateFormat:"dd/MM/yyyy",locale:"es",className:`form-input w-full dark:bg-gray-700 ${u.fecha?"border-rose-500":""}`,placeholderText:"Seleccionar fecha"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 dark:text-gray-300",children:"Hora Inicio"}),e.jsx(R,{selected:c.horaInicio,onChange:s=>m("horaInicio",s),hasError:u.horaInicio})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 dark:text-gray-300",children:"Hora Fin"}),e.jsx(R,{selected:c.horaFin,onChange:s=>m("horaFin",s),hasError:u.horaFin}),u.horaFin&&e.jsx("div",{className:"text-xs mt-1 text-rose-500",children:"La hora de fin debe ser posterior a la de inicio."})]}),e.jsx("div",{className:"md:col-span-4 flex justify-end mt-2",children:e.jsx("button",{type:"button",onClick:g,className:"btn bg-indigo-500 hover:bg-indigo-600 text-white",children:"Añadir Horario"})})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h3",{className:"text-md font-semibold text-gray-800 dark:text-gray-100 mb-2",children:"Horarios Agregados"}),r.length===0?e.jsx("div",{className:"text-center py-8 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Aún no se han agregado horarios para este evento."})}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table-auto w-full dark:text-gray-300",children:[e.jsx("thead",{className:"text-xs font-semibold uppercase text-gray-500 bg-gray-50 dark:bg-gray-700 dark:bg-opacity-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 whitespace-nowrap",children:e.jsx("div",{className:"font-semibold text-left",children:"Espacio Deportivo"})}),e.jsx("th",{className:"p-2 whitespace-nowrap",children:e.jsx("div",{className:"font-semibold text-left",children:"Fecha"})}),e.jsx("th",{className:"p-2 whitespace-nowrap",children:e.jsx("div",{className:"font-semibold text-left",children:"Hora Inicio"})}),e.jsx("th",{className:"p-2 whitespace-nowrap",children:e.jsx("div",{className:"font-semibold text-left",children:"Hora Fin"})}),e.jsx("th",{className:"p-2 whitespace-nowrap",children:e.jsx("div",{className:"font-semibold text-center",children:"Acciones"})})]})}),e.jsx("tbody",{className:"text-sm divide-y divide-gray-100 dark:divide-gray-700",children:r.map(s=>e.jsxs("tr",{children:[e.jsx("td",{className:"p-2 whitespace-nowrap",children:s.espacioDeportivo}),e.jsx("td",{className:"p-2 whitespace-nowrap",children:s.fecha}),e.jsx("td",{className:"p-2 whitespace-nowrap",children:s.horaInicio}),e.jsx("td",{className:"p-2 whitespace-nowrap",children:s.horaFin}),e.jsx("td",{className:"p-2 whitespace-nowrap text-center",children:e.jsx("button",{onClick:()=>v(s.id),className:"text-rose-500 hover:text-rose-600",children:"Eliminar"})})]},s.id))})]})})]})]})};function ce(){const{eventoId:t}=V(),{database:r,isLoading:f,actualizarEventoCompleto:p,guardarCambios:N}=_(),{settings:d,updateSettings:n}=G(),i=U(),[c,y]=b.useState(!1),[u,a]=b.useState(1),[m,x]=b.useState(!1),[g,v]=b.useState(null),[s,j]=b.useState(!1),[l,I]=b.useState(null),[C,D]=b.useState([]),[H,E]=b.useState({});b.useEffect(()=>{var o,h;if(!f&&r&&t){const k=parseInt(t),F=(o=r[B])==null?void 0:o.find(S=>S.id===k);if(F){I({...F});const S=((h=r[K])==null?void 0:h.filter(w=>w.eventoId===k))||[];D(S.map(w=>({...w})))}else console.error("Evento con ID",t,"no fue encontrado. Redirigiendo."),i("/gestion-eventos")}},[r,t,i,f]);const A=o=>{const{name:h,value:k,type:F,checked:S}=o.target;I(w=>({...w,[h]:F==="checkbox"?S:k})),H[h]&&E(w=>({...w,[h]:!1}))},O=()=>{const o={};return["nombreEvento","instalacion","tipoEvento","motivo","nombreRemitente","cargo","nombreSolicitante","dniRuc","correo","telefono"].forEach(k=>{l[k]||(o[k]=!0)}),l.representaInstitucion&&!l.cualInstitucion&&(o.cualInstitucion=!0),o},T=o=>{o.preventDefault();const h=O();E(h),Object.keys(h).length===0&&a(2)},$=()=>{E({}),a(1)},L=async()=>{if(C.length===0){E(o=>({...o,global:"Debe agregar al menos un horario para guardar el evento."}));return}try{console.log("Iniciando guardado..."),await p(l,C),await N(),console.log("¡Guardado completado con éxito!"),i("/gestion-eventos")}catch(o){console.error("Error al guardar los cambios del evento:",o),alert("Ocurrió un error al guardar los cambios. Por favor, intente de nuevo.")}},M=o=>{v(o),x(!0)},q=(o,h)=>{n({comboValues:{...d.comboValues,[o]:h}}),x(!1)},P=()=>`Editar ${{tiposEvento:"Tipos de Evento",motivos:"Motivos",espaciosDeportivos:"Espacios Deportivos"}[g]||"Lista"}`;return f||!l?e.jsx("div",{className:"flex h-screen items-center justify-center bg-gray-100 dark:bg-gray-900",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-lg font-semibold text-gray-600 dark:text-gray-300",children:"Cargando datos del evento..."}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Por favor, espere un momento."})]})}):e.jsxs("div",{className:"flex h-screen overflow-hidden",children:[e.jsx(X,{sidebarOpen:c,setSidebarOpen:y}),e.jsxs("div",{className:"relative flex flex-col flex-1 overflow-y-auto overflow-x-hidden",children:[e.jsx(Y,{sidebarOpen:c,setSidebarOpen:y}),e.jsx("main",{className:"grow",children:e.jsxs("div",{className:"px-4 sm:px-6 lg:px-8 py-8 w-full max-w-9xl mx-auto",children:[e.jsx("h1",{className:"text-2xl md:text-3xl text-gray-800 dark:text-gray-100 font-bold mb-8",children:"Editar Evento"}),e.jsx("div",{className:"bg-white dark:bg-gray-800 shadow-lg rounded-sm border border-gray-200 dark:border-gray-700 p-6",children:e.jsxs("form",{onSubmit:o=>o.preventDefault(),children:[u===1&&e.jsx(ee,{formData:l,handleInputChange:A,database:r,settings:d,handleOpenModal:M,handleOpenInstalacionesModal:()=>j(!0),errors:H}),u===2&&e.jsx(se,{formData:l,horarios:C,setHorarios:D,settings:d,handleOpenModal:M,errors:H,setErrors:E}),e.jsxs("div",{className:"flex justify-between items-center mt-8",children:[e.jsx("div",{children:u===2&&e.jsx("button",{onClick:$,className:"btn bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-100 hover:bg-gray-300 dark:hover:bg-gray-600",children:"Atrás"})}),e.jsxs("div",{className:"flex gap-4",children:[u===1&&e.jsx("button",{onClick:T,className:"btn bg-indigo-500 hover:bg-indigo-600 text-white",children:"Siguiente"}),u===2&&e.jsx("button",{onClick:L,className:"btn bg-emerald-500 hover:bg-emerald-600 text-white",children:"Guardar Cambios"})]})]})]})})]})}),e.jsx(Q,{modalOpen:m,setModalOpen:x,title:P(),items:g&&d.comboValues[g]?d.comboValues[g]:[],onSave:o=>q(g,o)}),e.jsx(Z,{isVisible:s,onClose:()=>j(!1),instalaciones:r.Instalaciones||[]})]})]})}export{ce as default};
