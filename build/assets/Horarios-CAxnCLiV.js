import{u as K,r as c,l as L,m as B,j as e,R as T}from"./index-g1PumTm4.js";import{S as Q,H as Z}from"./Header-HN8A8OWr.js";import{r as ee}from"./index-Ei0h8sv0.js";const b={emerald:"bg-emerald-100 dark:bg-emerald-400/30 text-emerald-600 dark:text-emerald-300",indigo:"bg-indigo-100 dark:bg-indigo-400/30 text-indigo-600 dark:text-indigo-300",sky:"bg-sky-100 dark:bg-sky-400/30 text-sky-600 dark:text-sky-300",yellow:"bg-yellow-100 dark:bg-yellow-400/30 text-yellow-600 dark:text-yellow-300",rose:"bg-rose-100 dark:bg-rose-400/30 text-rose-600 dark:text-rose-300",blue:"bg-blue-100 dark:bg-blue-400/30 text-blue-600 dark:text-blue-300",teal:"bg-teal-100 dark:bg-teal-400/30 text-teal-600 dark:text-teal-300",orange:"bg-orange-100 dark:bg-orange-400/30 text-orange-600 dark:text-orange-300",lime:"bg-lime-100 dark:bg-lime-400/30 text-lime-600 dark:text-lime-300",pink:"bg-pink-100 dark:bg-pink-400/30 text-pink-600 dark:text-pink-300",purple:"bg-purple-100 dark:bg-purple-400/30 text-purple-600 dark:text-purple-300",cyan:"bg-cyan-100 dark:bg-cyan-400/30 text-cyan-600 dark:text-cyan-300",amber:"bg-amber-100 dark:bg-amber-400/30 text-amber-600 dark:text-amber-300",fuchsia:"bg-fuchsia-100 dark:bg-fuchsia-400/30 text-fuchsia-600 dark:text-fuchsia-300"},P=Object.keys(b),te={Finalizado:"bg-rose-100 dark:bg-rose-500/30 text-rose-500 dark:text-rose-400","En Proceso":"bg-emerald-100 dark:bg-emerald-400/30 text-emerald-500 dark:text-emerald-400",Programado:"bg-sky-100 dark:bg-sky-500/30 text-sky-600 dark:text-sky-400"},$={instalacion:"all",institucion:"all",tipoEvento:"all",espacioDeportivo:"all"};function ae(){var M;const{database:x}=K(),[l,C]=c.useState(new Date),[R,A]=c.useState([]),[k,H]=c.useState({}),[y,j]=c.useState(!1),[S,z]=c.useState({date:null,events:[]}),[i,I]=c.useState($),[v,Y]=c.useState({instalaciones:[],instituciones:[],tiposEvento:[],espaciosDeportivos:[]}),N=c.useRef(null);c.useEffect(()=>{const t=({target:s})=>{!y||N.current&&N.current.contains(s)||j(!1)};return document.addEventListener("click",t),()=>document.removeEventListener("click",t)},[y]);const _=t=>{const[s,r,o]=t.split("/");return new Date(o,parseInt(r)-1,s)};c.useEffect(()=>{const t=x[L]||[],s=x[B]||[],r=[...new Set(t.map(a=>a.instalacion).filter(Boolean))],o=[...new Set(t.map(a=>a.representaInstitucion?a.cualInstitucion:"PÚBLICO").filter(Boolean))],p=[...new Set(t.map(a=>a.tipoEvento).filter(Boolean))],h=[...new Set(s.map(a=>a.espacioDeportivo).filter(Boolean))];Y({instalaciones:r.sort(),instituciones:o.sort(),tiposEvento:p.sort(),espaciosDeportivos:h.sort()})},[x]),c.useEffect(()=>{const t=x[B]||[],s=x[L]||[],r=new Map(s.map(a=>[a.id,a])),h=t.map(a=>({...r.get(a.eventoId)||{},...a})).filter(a=>{const g=a.representaInstitucion?a.cualInstitucion:"PÚBLICO";return(i.instalacion==="all"||a.instalacion===i.instalacion)&&(i.institucion==="all"||g===i.institucion)&&(i.tipoEvento==="all"||a.tipoEvento===i.tipoEvento)&&(i.espacioDeportivo==="all"||a.espacioDeportivo===i.espacioDeportivo)}).reduce((a,g)=>{const d=_(g.fecha).toDateString();return a[d]||(a[d]=[]),a[d].push(g),a},{});H(h)},[x,i]),c.useEffect(()=>{const t=l.getFullYear(),s=l.getMonth(),r=new Map;let o=0;const p=new Date(t,s+1,0).getDate();Object.values(k).flat().forEach(n=>{r.has(n.eventoId)||(r.set(n.eventoId,P[o%P.length]),o++)});const a=new Date(t,s,1).getDay(),g=a===0?6:a-1,d=[],D=new Date(t,s,0).getDate();for(let n=0;n<g;n++)d.push({day:D-g+1+n,isCurrentMonth:!1,events:[]});for(let n=1;n<=p;n++){const m=new Date(t,s,n).toDateString(),G=(k[m]||[]).map(F=>({...F,color:r.get(F.eventoId)}));d.push({day:n,isCurrentMonth:!0,isToday:new Date().toDateString()===m,events:G})}const u=d.length,w=u>35?42-u:35-u;for(let n=1;n<=w;n++)d.push({day:n,isCurrentMonth:!1,events:[]});A(d)},[l,k]);const U=(t,s,r)=>{const o=new Date,p=(g,d)=>{const[D,u,w]=g.split("/");let[n,E]=d.split(" "),[m,O]=n.split(":");return m==="12"&&(m="00"),E&&E.toUpperCase()==="PM"&&(m=parseInt(m,10)+12),new Date(w,parseInt(u)-1,D,m,O)},h=p(t,s),a=p(t,r);return o>a?"Finalizado":o>=h&&o<=a?"En Proceso":"Programado"},V=(t,s)=>{if(t.stopPropagation(),s.isCurrentMonth&&s.events.length>0){const r=new Date(l.getFullYear(),l.getMonth(),s.day);z({date:r,events:s.events}),j(!0)}},f=t=>{const{name:s,value:r}=t.target;I(o=>({...o,[s]:r}))},W=()=>I($),J=()=>C(new Date(l.getFullYear(),l.getMonth()-1,1)),X=()=>C(new Date(l.getFullYear(),l.getMonth()+1,1)),q=["L","M","X","J","V","S","D"];return e.jsxs(T.Fragment,{children:[e.jsxs("div",{className:"col-span-12 bg-white dark:bg-gray-800 shadow-lg rounded-sm border border-gray-200 dark:border-gray-700",children:[e.jsxs("header",{className:"px-5 py-4 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center",children:[e.jsx("h2",{className:"font-semibold text-gray-800 dark:text-gray-100",children:"Calendario de Horarios"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{onClick:J,className:"btn-sm bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200 hover:bg-gray-300 dark:hover:bg-gray-600",children:"<"}),e.jsx("h3",{className:"font-semibold text-lg text-gray-800 dark:text-gray-100 mx-4",children:l.toLocaleString("es-ES",{month:"long",year:"numeric"}).replace(/^\w/,t=>t.toUpperCase())}),e.jsx("button",{onClick:X,className:"btn-sm bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200 hover:bg-gray-300 dark:hover:bg-gray-600",children:">"})]})]}),e.jsx("div",{className:"p-4 border-b border-gray-100 dark:border-gray-700",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-5 gap-4",children:[e.jsxs("select",{name:"instalacion",value:i.instalacion,onChange:f,className:"form-select w-full text-sm dark:bg-gray-700 dark:text-gray-200",children:[e.jsx("option",{value:"all",children:"Toda Instalación"}),v.instalaciones.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsxs("select",{name:"institucion",value:i.institucion,onChange:f,className:"form-select w-full text-sm dark:bg-gray-700 dark:text-gray-200",children:[e.jsx("option",{value:"all",children:"Toda Institución"}),v.instituciones.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsxs("select",{name:"tipoEvento",value:i.tipoEvento,onChange:f,className:"form-select w-full text-sm dark:bg-gray-700 dark:text-gray-200",children:[e.jsx("option",{value:"all",children:"Todo Tipo de Evento"}),v.tiposEvento.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsxs("select",{name:"espacioDeportivo",value:i.espacioDeportivo,onChange:f,className:"form-select w-full text-sm dark:bg-gray-700 dark:text-gray-200",children:[e.jsx("option",{value:"all",children:"Todo Espacio Deportivo"}),v.espaciosDeportivos.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsx("button",{onClick:W,className:"btn-sm bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200 hover:bg-gray-300 dark:hover:bg-gray-600 w-full",children:"Limpiar Filtros"})]})}),e.jsx("div",{className:"p-3",children:e.jsxs("div",{className:"grid grid-cols-7 gap-px",children:[q.map(t=>e.jsx("div",{className:"text-center text-xs font-semibold text-gray-500 p-2",children:t},t)),R.map((t,s)=>e.jsxs("div",{onClick:r=>V(r,t),className:`relative h-20 md:h-28 p-1 text-sm border border-gray-100 dark:border-gray-700/60 ${t.isCurrentMonth?"bg-white dark:bg-gray-800":"bg-gray-50 dark:bg-gray-800/50"} ${t.events.length>0&&t.isCurrentMonth?"cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700/50":""}`,children:[e.jsx("div",{className:`text-right ${!t.isCurrentMonth&&"opacity-40"} ${t.isToday&&"font-bold text-violet-600"}`,children:t.day}),t.events.length>0&&e.jsxs("div",{className:"absolute bottom-1 left-1 right-1 px-1",children:[t.events.slice(0,3).map(r=>e.jsx("div",{className:`truncate text-xs rounded px-1 mb-0.5 ${b[r.color]||b.emerald}`,children:r.nombreEvento},r.id)),t.events.length>3&&e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["+ ",t.events.length-3," más"]})]})]},s))]})})]}),ee.createPortal(e.jsxs(T.Fragment,{children:[e.jsx("div",{className:`fixed inset-0 bg-gray-900 bg-opacity-30 z-50 transition-opacity ${y?"opacity-100":"opacity-0 pointer-events-none"}`,"aria-hidden":"true"}),e.jsx("div",{id:"event-modal",className:`fixed inset-0 z-50 overflow-hidden flex items-center justify-center transform px-4 sm:px-6 transition-all ${y?"opacity-100 scale-100":"opacity-0 scale-95 pointer-events-none"}`,children:e.jsxs("div",{ref:N,className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-auto max-w-lg w-full max-h-full",children:[e.jsx("div",{className:"px-5 py-3 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"font-semibold text-gray-800 dark:text-gray-100",children:["Eventos del ",(M=S.date)==null?void 0:M.toLocaleDateString("es-ES",{weekday:"long",day:"numeric"})]}),e.jsxs("button",{onClick:()=>j(!1),className:"text-gray-400 dark:text-gray-500 hover:text-gray-500 dark:hover:text-gray-400",children:[e.jsx("div",{className:"sr-only",children:"Close"}),e.jsx("svg",{className:"w-4 h-4 fill-current",children:e.jsx("path",{d:"M7.95 6.536l4.242-4.243a1 1 0 111.415 1.414L9.364 7.95l4.243 4.242a1 1 0 11-1.415 1.415L7.95 9.364l-4.243 4.243a1 1 0 01-1.414-1.415L6.536 7.95 2.293 3.707a1 1 0 011.414-1.414L7.95 6.536z"})})]})]})}),e.jsx("div",{className:"p-5",children:e.jsx("div",{className:"space-y-4",children:S.events.map(t=>{var r,o;const s=U(t.fecha,t.horaInicio,t.horaFin);return e.jsxs("div",{className:`p-4 rounded-lg border-l-4 ${(r=b[t.color])==null?void 0:r.replace("text-","border-").replace(/bg-([a-z]+)-100/,"border-$1-500")} bg-gray-50 dark:bg-gray-700/20`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h4",{className:`font-bold text-lg ${(o=b[t.color])==null?void 0:o.split(" ")[2]}`,children:t.nombreEvento}),e.jsx("span",{className:`text-xs font-medium px-2.5 py-0.5 rounded-full ${te[s]}`,children:s})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-x-4 gap-y-1 text-sm",children:[e.jsxs("p",{className:"text-gray-800 dark:text-gray-200",children:[e.jsx("strong",{className:"font-semibold",children:"Remitente:"})," ",t.nombreRemitente||"N/A"]}),e.jsxs("p",{className:"text-gray-800 dark:text-gray-200",children:[e.jsx("strong",{className:"font-semibold",children:"Institución:"})," ",t.representaInstitucion?t.cualInstitucion:"PÚBLICO"]}),e.jsxs("p",{className:"text-gray-800 dark:text-gray-200",children:[e.jsx("strong",{className:"font-semibold",children:"Tipo:"})," ",t.tipoEvento||"N/A"]}),e.jsxs("p",{className:"text-gray-800 dark:text-gray-200",children:[e.jsx("strong",{className:"font-semibold",children:"Instalación:"})," ",t.instalacion||"N/A"]}),e.jsxs("p",{className:"text-gray-800 dark:text-gray-200",children:[e.jsx("strong",{className:"font-semibold",children:"Espacio:"})," ",t.espacioDeportivo||"N/A"]}),e.jsxs("p",{className:"text-gray-800 dark:text-gray-200",children:[e.jsx("strong",{className:"font-semibold",children:"Horario:"})," ",t.horaInicio," - ",t.horaFin]})]})]},t.id)})})})]})})]}),document.body)]})}function oe(){const[x,l]=c.useState(!1);return e.jsxs("div",{className:"flex h-screen overflow-hidden",children:[e.jsx(Q,{sidebarOpen:x,setSidebarOpen:l}),e.jsxs("div",{className:"relative flex flex-col flex-1 overflow-y-auto overflow-x-hidden",children:[e.jsx(Z,{sidebarOpen:x,setSidebarOpen:l}),e.jsx("main",{className:"grow",children:e.jsxs("div",{className:"px-4 sm:px-6 lg:px-8 py-8 w-full max-w-9xl mx-auto",children:[e.jsx("div",{className:"sm:flex sm:justify-between sm:items-center mb-8",children:e.jsx("div",{className:"mb-4 sm:mb-0",children:e.jsx("h1",{className:"text-2xl md:text-3xl text-gray-800 dark:text-gray-100 font-bold",children:"Horarios"})})}),e.jsx("div",{className:"grid grid-cols-12 gap-6",children:e.jsx(ae,{})})]})})]})]})}export{oe as default};
